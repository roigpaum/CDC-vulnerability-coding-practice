---
title: "CDC SVI analysis"
output:
  html_document: default
date: "28 April 2022"
bibliography: practicereference.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import software, be a cool cat
### this is just for style, it doesn't really matter

```{r message=FALSE}
library(readr)
library(purrr)
library(dplyr)
```

Read data
```{r message=FALSE}
svi_data <- read_csv("data/cdc_svi_oregon_county_subset.csv")
svi_data
```

identify metrics of interest and store
```{r}
metrics <- c("EP_POV", "EP_DISABL", "EP_MINRTY", "EP_AGE65", "EP_LIMENG", "EP_CROWD", "EP_SNGPNT")
high_is_vulnerable <- c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE)
svi_data[metrics]
```

We are evaluating `r length(metrics)` metrics.

```{r}
standardize <- function(input, flip=FALSE) {
  output <- return(rank(input)/length(input))
  if (flip) {
    output <- 1-output
  }
  return(output)
}
```

the rest
```{r}
#For one value
map_dfc(svi_data[metrics], standardize)

#For 2 values, now where low is less vulnerable, and high is more vulnerable. ! makes the reciprocal
standardized_data <- map2_dfc(svi_data[metrics],! high_is_vulnerable, standardize)
standardized_data <- bind_cols(svi_data["COUNTY"], standardized_data)

#Consolidate metrics into one 
standardized_data$summary <- rowSums(standardized_data[metrics])

#Sort results by vulnerability
standardized_data <- standardized_data[order(standardized_data$summary),]

#Save the results and you can look at it in spreadsheet
write.csv(standardized_data, file = "county_rankings.csv")
```

